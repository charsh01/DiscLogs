{% extends "base.html" %}

{% block title %}Disclogs{% endblock %}

{% block content %}


<h1><img src="static\images\disclogs_logo.png" style="min-width: 250px; max-width: 250px; padding-left: 10px; margin-top: 10px; position: relative; bottom:-15px;" alt="Disclogs"></h1>
<hr/>
<div class="main">
    <div class="left">
        <div class="aspectspacer">
            <!-- Left-hand column with different user options. -->

            <!-- Insert select options: discogs or collection. -->
            <!-- Search forms. -->
            <div class="row">  
                <label for="location_input" class="div_label">Data:</label>
                <select id="location_input" style="height: 20px">
                    <option value="discogs">Discogs</option>
                    <option value="collection">My Collection</option>
                </select>
            </div>
            <div class="row">  
                <div class="div_label">Artist:</div>      
                <div><input type="text" id="artist_input"></div> 
            </div>
            <div class="row">      
                <div class="div_label">Album:</div>     
                <div><input type="text" id="album_input"></div>  
            </div>    
            <div class="row">     
                <div class="div_label">Label:</div>       
                <div><input type="text" id="label_input"></div> 
            </div>    
            <!-- <div class="row">     
                <div class="div_label">Year:</div>       
                <div><input type="text" id="year_input"></div> 
            </div>     -->
            <div class="row">        
                <label for="format_input" class="div_label">Format:</label>
                <select id="format_input" style="height: 20px">
                    <option value="">All</option>
                    <option value="vinyl">Vinyl</option>
                    <option value="CD">CD</option>
                    <option value="Cass">Cassette</option>
                    <option value="Other">Other</option>
                </select>
                <button id="search_button" type="submit" style="height: 20px; padding-left:20px; padding-right:19px; margin-left:9px; margin-bottom: 10px">Search</button>
            </div>
        <hr/>
            <div style="display: flex; justify-content: center; align-items: center">
                <button id="search_button" type="submit" style="height: 20px; margin-top: 10px; margin-bottom: 10px">Export to .csv</button>
            </div>
        <hr/>

        </div>
    </div>
    <div id="right">
        <div id="reset" style="border: 1cap; border-width: 1cap; overflow-x: hidden; overflow-y: auto; height: 75vh;">
            <div id="result_number">
            </div>
            <div id="div1">
                <!-- insert 'searching' gif here. -->
            </div>
        </div>
    </div>
    <div id="version_window">
        <div id="reset" style="overflow-x: hidden; overflow-y: auto; width: 10vw; height: 75vh;">
            <div id="div1">
                <!-- insert 'searching' gif here. -->
            </div>
        </div>
    </div>
</div>

<script>

function reset_container(id) {
    let new_div1 = document.createElement("div1");
    new_div1.setAttribute('id',"div1");
    document.getElementById(id).innerHTML = "";
    document.getElementById(id).appendChild(new_div1);
}

var search_button = document.getElementById("search_button");

search_button.addEventListener('click', e => {

    reset_container("reset");

    try {
        var location_input = document.getElementById("location_input").value;
    }
    catch(err) {
        var location_input = "";
    }
    try {
        var artist_input = document.getElementById("artist_input").value;
    }
    catch(err) {
        var artist_input = "";
    }
    try {
        var album_input = document.getElementById("album_input").value;
    }
    catch(err) {
        var album_input = ""; 
    }
    try {
        var label_input = document.getElementById("label_input").value;
    }
    catch(err) {
        console.log("label error")
        var label_input = "";
    }
        
    // try {
    //     var year_input = document.getElementById("year_input").value;
    // }
    // catch(err) {
    //     var year_input = "" 
    // }
    try {
        var format_input = document.getElementById("format_input").value;
    }
    catch(err) {
        var format_input = ""; 
    }
    
    var inputs = {"location": location_input, "artist": artist_input, "album": album_input, "label": label_input, "format":format_input};

    if (location_input == "discogs"){
        fetch("/search", {
            method: 'POST',
            headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},
            body: JSON.stringify(inputs)
            })
            // expecting json
        .then(response => response.json())
        // what doing with data
        .then(data => {
            // console.log(data);

            // Create new container for each entry returned by search.
            for (var i = 0; i < data.length; i++) {
                const old_container = document.getElementById("div1");
                const new_container = document.createElement("div2");
                const l_container = document.createElement("div");
                const r_container = document.createElement("div");
                const img_button = document.createElement("button");

                new_container.setAttribute('class',"box");
                l_container.setAttribute('class',"lbox");
                r_container.setAttribute('class',"rbox");

                // Handle each element in the entry
                for (var j = 0; j < 6; j++){

                    // Create button with album art.
                    if (j == 0) {
                        var release_id = String(data[i]['release_data'][1]);
                        img_button.setAttribute('id', release_id);
                        img_button.setAttribute('class','button_style');
                        img_button.style.background = "url("+data[i]['release_data'][0]+")";
                        img_button.style.backgroundSize = "100px";
                        l_container.appendChild(img_button);
                        new_container.appendChild(l_container);

                        // Add to collection button - have it hover in center of album art.
                        if (data[i]['in_collection'] == false){
                            img_button.style.borderColor = "red";
                                                    }
                        if (data[i]['in_collection'] == true){
                            img_button.style.borderColor = "green";
                        }
                        // Send specific release id back (to then return version data).
                        img_button.addEventListener('click', e => {
                            fetch("/versions", {
                            method: 'POST',
                            headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},
                            body: JSON.stringify(img_button.id)
                            })
                        })
                    }
                    else {
                        const new_line = document.createTextNode(data[i]['release_data'][j]);
                        const txt_container = document.createElement("div");
                        txt_container.setAttribute('class',"text_row");
                        txt_container.appendChild(new_line);
                        r_container.appendChild(txt_container);
                        new_container.appendChild(r_container);
                    }
                old_container.parentNode.insertBefore(new_container, old_container.nextSibling);
                } 
            }  
        })
    }
    else if (location_input == "collection"){
        fetch("search_collection", {
            method: 'POST',
            headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},
            body: JSON.stringify(inputs)
            })
            // expecting json
            .then(response => response.json())
            // what doing with data
            .then(data => {
                console.log(data);

                // Result number.
                const result_number = document.createTextNode(data.length+" Results:");
                const old_container = document.getElementById("div1");
                old_container.appendChild(result_number);




                for (var i = 0; i < data.length; i++) {
                    const new_container = document.createElement("div");
                    const l_container = document.createElement("div");
                    const r_container = document.createElement("div");

                    new_container.setAttribute('class',"box");
                    l_container.setAttribute('class',"lbox");
                    r_container.setAttribute('class',"rbox");

                    // const line_catalog = document.createTextNode(data[i]['Catalog#'])
                    // const line_artist = document.createTextNode(data[i]['Artist'])
                    // const line_title = document.createTextNode(data[i]['Title'])
                    // const line_label = document.createTextNode(data[i]['Label'])
                    // const line_format = document.createTextNode(data[i]['Format'])
                    // const line_genre = document.createTextNode(data[i]['Genre'])
                    // const line_rating = document.createTextNode(data[i]['Rating'])
                    // const line_released = document.createTextNode(data[i]['Released'])
                    // const line_folder = document.createTextNode(data[i]['CollectionFolder'])
                    // const line_added = document.createTextNode(data[i]['Date Added'])
                    // const line_mediacon = document.createTextNode(data[i]['Collection Media Condition'])
                    // const line_sleevecon = document.createTextNode(data[i]['Collection Sleeve Condition'])
                    // const line_notes = document.createTextNode(data[i]['Collection Notes'])

                    const img_button = document.createElement("button");
                    // img_button.src = data[i]["img_url"];
                    // img_button.setAttribute('height', '100px');
                    // img_button.setAttribute('width', '100px');
                    img_button.setAttribute('id', data[i]["release_id"]);
                    img_button.setAttribute('class','button_style');
                    img_button.style.background = "url("+data[i]["img_url"]+")";
                    img_button.style.backgroundSize = "100px";
                    l_container.appendChild(img_button);
                    new_container.appendChild(l_container);
                    // id_return = String(data[i]["release_id"]);
[]
                    // Send specific release id back (to then return version data).
                    img_button.addEventListener('click', e => {
                        fetch('/selected', {
                            method: 'POST',
                            headers: {'Accept': 'application/json', 'Content-Type': 'application/json'},
                            body: JSON.stringify(img_button.id)
                            })
                        })

                    for (var key in data[i]){
                        if (key == "Artist" || key == "Title") {
                            const new_line = document.createTextNode(key + ": " + data[i][key]);
                            const txt_container = document.createElement("div");
                            txt_container.setAttribute('class',"text_row");
                            txt_container.appendChild(new_line);
                            r_container.appendChild(txt_container);
                            new_container.appendChild(r_container);
                        }
                    old_container.parentNode.insertBefore(new_container, old_container.nextSibling);
                    }





                    // const txt_container = document.createElement("div");
                    // txt_container.setAttribute('class',"text_row");

                    // txt_container.appendChild(line_catalog);

                    // r_container.appendChild(txt_container);
                    // new_container.appendChild(r_container);


                    // for (var j = 0; j < data[i].length; j++){
                    //     console.log(data[0]);
                    //     const new_line = document.createTextNode(data[i][j]);
                    //     const txt_container = document.createElement("div");
                    //     txt_container.setAttribute('class',"text_row");
                    //     txt_container.appendChild(new_line);
                    //     r_container.appendChild(txt_container);
                    //     new_container.appendChild(r_container);
                    }
                } 
            )
    }  
})





</script>
{% endblock %}